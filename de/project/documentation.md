## Editorische Umsetzung

### Handschriften-Transkriptionen und kritische Editionen

-> S. hier: [Editionsrichtlinien](../project/encoding-guidelines)

### Texte
Soweit vorhanden werden für alle Texte Links auf die entsprechenden Werk-Einträge der [Clavis Clavium](https://clavis.brepols.net/clacla/Default.aspx)- und der [Pinakes-](https://pinakes.irht.cnrs.fr/) Datenbank gesetzt; außerdem werden die Autoren-/Werk-IDs des TLG© angezeigt (eine Verlinkung ist nicht möglich).

Die zugrundliegenden Daten sind auf [Github](https://github.com/PatristicTextArchive/pta_data) oder [Zenodo](https://doi.org/10.5281/zenodo.4066796) erhältlich.

Jede Edition ist über einen **Permalink** (unter Verwendung der CTS-URN) erreichbar: z.B. <https://pta.bbaw.de/text/urn:cts:pta:pta0013.pta003.pta-grc1>. Der jeweilige Permalink ist in der Leseoberfläche unter der Rubrik `Nachnutzung` angeführt. Permalinks existieren auch für Autoren/Textgruppen: <https://pta.bbaw.de/text/urn:cts:pta:pta0013>, sowie für Werke: <https://pta.bbaw.de/text/urn:cts:pta:pta0013.pta003>.

### Darstellung textlicher Phänomene im Reader

#### Transkriptionen

| Darstellung | Phänomen |
|----|-----|
| neue Zeile | neue Zeile |
| <span style="color:gray;">[1r/v]</span> | neues Blatt/Seite mit Nummer 1 (recto/verso) (ggfs. verlinkt mit Faksimile)|
| <span style="color:gray;">[col.]</span> | neue Spalte |
| <span style="color:gray;">[note: Ort] Text (Hand)</span> | Marginalie mit Text an Ort (ggfs. Angabe der Hand) |
| <span style="color:red;">Text</span> | rubrizierter Text |
| <span style="text-decoration:overline;">Text</span> | Line über Text (oft: Nomen sacrum) |
| <span style="font-size: 110%;font-weight:bold;padding-right:.1rem;">T</span>ext | Ekthesis |
| <span style="font-size: 2rem;font-weight:bold;padding:.3rem;margin:0 .3rem 0 0;float:left;line-height:1;">T</span>ext | Initiale |
| ⸢gelöscht hinzugefügt (Hand)⸣ | Ersetzung von gelöscht durch Hinzugefügt (ggfs. Angabe der Hand) |
| Text<sup>del.</sup> (Hand) | gelöschter Text (ohne weitere Markierung, ggfs. von Hand)|
| Text* (Hand)| gelöschter Text (markiert durch Zeichen; ggfs. von Hand) |
| <span style="text-decoration: line-through;">Text</span> (Hand) | gelöschter Text (durchgestrichen; ggfs. von Hand) |
| <span style="text-decoration: underline; text-decoration-style: dotted;">Text</span> (Hand) | gelöschter Text (expungiert; ggfs. von Hand) |
| <span style="text-decoration: line-through; text-decoration-style: double;">Text</span> (Hand) | gelöschter Text (überschrieben; ggfs. von Hand) |
| <span style="color:gray;">Text</span> (Hand) | gelöschter Text (ausradiert; ggfs. von Hand) |
| ⟨Text (Hand)⟩ | Hinzugefügter Text (in der Zeile; ggfs. von Hand) |
| Text<span style="font-size: 80%; vertical-align: super;">⟨Text (Hand)⟩</span> | Zu Text hinzugefügter Text (über der Zeile; ggfs. von Hand) |
| _⟨Hand in mg. Text⟩_ |  Am Rand hinzugefügter Text (ggfs. von Hand) |
| {Text} | Ergänzung von verlorenem Text |
| <span style="text-decoration: underline wavy;">Text</span> | Text unsicher |
| > | Diple |
| >> | Doppelte Diple |
| ⸏ | Paragraphos |
| * | Asteriskos |
| <span style="color:gray; font-size: 80%;">[[illegible (1 line)]]</span> | Nicht lesbarer Text (ggfs. von geschätzter Länge) |
| <span style="color:gray; font-size: 80%;">[[damage (1 character)]]</span> | Physische Beschädigung (ggfs. von geschätzter Länge) |
| <span style="color:gray; font-size: 80%;">[[fenestra (1 character)]]</span> | Fenestra (ggfs. von geschätzter Länge) |
| <span style="color:gray; font-size: 80%;">(1.1 Edition)</span> | Verweis auf Paragrapheneinteilung der Edition |

#### Editionen

| Darstellung | Phänomen |
|----|-----|
| <span style="color:darkred;font-style:italic;">»Text«</span> | Lemma-Zitat |
| »Text_, Einfügung,_ Text« | Zitat (mit Einfügung) |
| ›Text‹ | Pseudozitat (bzw. Zitat im Zitat oder in wörtl. Rede) |
| „Text ‚Text‘ Text“ | Wörtliche Rede |
| _Text_ | Anspielung |
| ⟨Text⟩ | Hinzugefügter Text |
| [Text] | Zu tilgender Text | 
| †Text† | Crux interpretum |
| <span style="color:gray; font-size: 80%;">[[lacunam (1 line) ind. Autor/Quelle]]</span> | Lacuna ggfs. von geschätzter Länge, ggfs. angezeigt von Autor/Quelle |
| <span style="color:gray;">[1 (Edition/Handschrift)]</span> | neue Seite mit Nummer 1 (in Edition/Handschrift) |

### Handschriftendatenbank

Die Handschriftendatenbank umfasst momentan nur rudimentäre Daten zu den Handschriften, die im PTA edierte Werke überliefern.
Die Daten basieren auf den Angaben der [Pinakes-Datenbank](https://pinakes.irht.cnrs.fr/) (= »Entwurf«-Status), die von den jeweiligen Bearbeitern durch Autopsie ergänzt wurden.

Verlinkt sind neben dem jeweiligen Eintrag in der [Pinakes-Datenbank](https://pinakes.irht.cnrs.fr/) (soweit vorhanden) Digitalisate und IIIF-Manifeste sowie für die in der Handschrift überlieferten Texte die Editionen im PTA bzw. der entsprechende Eintrag in der [Clavis Clavium-Datenbank](https://clavis.brepols.net/clacla/Default.aspx) oder der [Database of Byzantine Book Epigrams](https://www.dbbe.ugent.be).

Die zugrundliegenden Daten sind auf [Github](https://github.com/PatristicTextArchive/pta_manuscripts) erhältlich.

Jede Handschrift ist über einen **Permalink** (unter Verwendung der PTA-internen Handschriften-ID) errichbar: z.B. <https://pta.bbaw.de/manuscripts/PTAMS00001>.

### Personen
In den Editionen vorkommende Personen werden nach Möglichkeit ausgezeichnet und mit weiteren Informationen aus anderen Quellen angereichert. Diese Funktionalität steht erst teilweise zur Verfügung.

Für biblische Personen wird dabei auf die [TIPNR - Translators Individualised Proper Names with all References](https://github.com/tyndale/STEPBible-Data) zurückgegriffen, für alle übrigen Personen wird ein eigenes Register geführt, in dem – soweit vorhanden – die IDs der GND referenziert werden, wobei auf den Service [lobid-gnd | ein LOD-Dienst des hbz — Hochschulbibliothekszentrum des Landes NRW](https://lobid.org/gnd) zurückgegriffen wird.

Es wird ein [Register](https://pta.bbaw.de/indices/persons) aller annotierten Personen bereitgestellt. Die Quelle, auf der die Beschreibung der Person basiert ist jeweils abgekürzt angegeben: TIPNR = Translators Individualised Proper Names with all References (s.o.), AW_III_5 = Athanasius Werke III 5, Verzeichnis der Personen (Berlin/Boston 2020), AvS = Annette von Stockhausen.

### Orte

In den Editionen vorkommende Orte werden nach Möglichkeit ebenfalls ausgezeichnet und mit weiteren Informationen aus dem [Pleiades-Gazetteer](https://pleiades.stoa.org/) bzw. der [Translators Individualized Proper Names with all References](https://github.com/tyndale/STEPBible-Data)-Liste angereichert.

Es wird ein [Register](https://pta.bbaw.de/indices/places) aller annotierten Orte bereitgestellt. Der im Register ausgewählte Ort wird auf einer Karte dargestellt; dafür wird auf den [Digital Atlas of the Roman Empire (DARE)](https://dh.gu.se/dare/) zurückgegriffen.

### Bibelstellen

In den Editionen vorkommende Bibelzitate (oder -anspielungen) werden ebenfalls nach Möglichkeit ausgezeichnet.

Die ausgezeichneten Stellen werden in einem Popup nachgewiesen und zitieren die jeweilige Bibelstelle. Dabei wird für alttestamentliche Stellen auf die Digitalisierung der Septuaginta-Edition von *Rahlfs* auf http://ccat.sas.upenn.edu/gopher/text/religion/biblical (via [The Unbound Bible](http://unbound.biola.edu/index.cfm) – nicht mehr online) zurückgegriffen und für neutestamentlichen Stellen auf das SBL Greek New Testament (Copyright © 2010 [Society of Biblical Literature](http://www.sbl-site.org) and [Logos Bible Software](http://www.logos.com), markiert mit *[SBLGNT](http://sblgnt.com)*).

Es wird ein [Register](https://pta.bbaw.de/indices/biblical-references) aller annotierten Bibelstellen bereitgestellt.
### Lexikon
Die Lexikon-Funktion befindet sich noch in Entwicklung. Momentan steht sie nur für griechische Texte (und wegen der vielen orthographischen Abweichungen nicht für Handschriftentranskriptionen) zur Verfügung.

Sie basiert auf einer mit Hilfe von [Clérice, T. (2021). Pie Extended, an extension for Pie with pre-processing and post-processing (Version 0.0.39) [Computer software]](https://doi.org/10.5281/zenodo.3883589) durchgeführten maschinellen (= nicht fehlerfreien) Lemmatisierung.

Für die Lexikon-Daten wird auf *Liddell-Scott-Jones, Greek-English Lexicon (9th ed., 1940)*, auf *Pape, Griechisch-deutsches Handwörterbuch (3. Aufl., 1914)* in den von [Chaeréphon (André Charbonnet) zur Verfügung gestellten digitalen Versionen](http://chaerephon.e-monsite.com/medias/files/bailly.html) (vermittelt durch [biblissima/eulexis](http://outils.biblissima.fr/resources/eulexis/data.tar.gz)) sowie auf *Translators Brief lexicon of Extended Strongs for Greek*, welches auf *Abbot-Smith, A Manual Greek Lexicon of the New Testament (1922)* basiert und so von [StepBible.org (CC BY lizensiert)](https://github.com/STEPBible/STEPBible-Data/blob/master/TBESG%20-%20Translators%20Brief%20lexicon%20of%20Extended%20Strongs%20for%20Greek%20-%20STEPBible.org%20CC%20BY.txt) zur Verfügung gestellt wird, zurückgegriffen.

### Analyse mit Hilfe der Voyant Tools

Die XML-Fassung des jeweiligen Textes kann per Klick an die [Voyant Tools](https://voyant-tools.org/) übergeben werden und mit den dort zur Verfügung stehenden Tools analysiert werden. Zu beachten ist, dass die Texte nicht lemmatisiert sind. In Zukunft werden für diese Funktion auch lemmatisierte Texte zur Verfügung gestellt werden.

### Titelbild

Das Titelbild des PTA ist ein Ausschnitt aus [f. 78r der Handschrift Paris, BnF, Grec 510](https://gallica.bnf.fr/ark:/12148/btv1b84522082/f169) (Source gallica.bnf.fr / BnF).

## Technische Umsetzung

### API (ediarum.Web)

Auf die Daten kann über die öffentlich verfügbare API zugegriffen werden. Die API wird mithilfe des ediarum-Moduls [ediarum.WEB](https://github.com/ediarum/ediarum.WEB) bereitgestellt. Die einzelnen Endpoints und Zugriffe werden in einer eXist-db-Applikation und einer zentralen ediarum.WEB kompatiblen Manifestdatei definiert. Siehe dazu auch die entsprechende [Dokumentation](https://github.com/ediarum/ediarum.WEB/blob/master/APPCONF.md).

Es gibt verschiedene Typen von Endpoints (detailliertere Informationen der Endpoints und möglicher Parameter findet sich in der entsprechenden [Dokumentation](https://github.com/ediarum/ediarum.WEB/blob/master/API.md)):

- Unter `/api` erhält man die Manifestdatei (`appconf.xml`), welche die vollständige Definition der Endpoints enthält.
- Die Endpoints für Objektsammlungen `/api/<object-type>` und Endpoints für einzelne Objekte `/api/<object-type>/<object-id>` erlauben den Zugriff auf folgende Objekttypen:
  - `cts` stellt eine [CTS-kompatible Schnittstelle](https://github.com/cite-architecture/cts_spec/blob/master/md/specification.md) zur Verfügung (nur GetPassage ist implementiert)
    - Beispiel für Abruf einer Passage über die CTS-API: <http://pta.bbaw.de/api/cts?request=GetPassage&urn=urn:cts:pta:pta0036.pta001.pta-grc1:2.1.4>.
  - `pta` umfasst die Editionstexte
  - `pta-textgroup` umfasst Metadaten zu den Textgruppen (nach Autoren)
  - `pta-work` umfasst Metadaten zu einzelnen Werken
  - `pta-version` umfasst Metadaten zu Ausgaben der Werke (Editionen, Übersetzungen)
  - `msdesc` umfasst Handschriftenbeschreibungen
  - `msitem` umfasst Informationen zu den in den Handschriftenbeschreibungen enthaltenen Werken
  - `author` umfasst das Autorenregister
  - `persons` umfasst Personen
  - `places` umfasst Orte
  - `pta-other-work` umfasst Metadaten zu nicht edierten Werken
  - `bible-quotation` umfasst Bibelzitate
  - `pta-lexicon-grc` umfasst Lexikoneinträge zu Lemmata, die in den Texten des PTA vorkommen
  - `wordlemma-grc` umfasst Lemmatisierungen zu den Worten, die in den Texten des PTA vorkommen
- Endpoints für Beziehungen zwischen Objekten
- Endpoints für Suchen; `/api/search/<search-id>` enthält folgende Suchmöglichkeiten:
  - `fulltext` Suche im Volltext ohne Varianten und ohne Anmerkungen
  - `metadata` Suche in den Metadaten der Texte
  - `readings` Suche in den Varianten
  - `notes` Suche in den Anmerkungen


### Backend (eXist-DB)

Die Daten für die Webapplikation liegen in einer [eXist-db](http://www.exist-db.org/) und werden über das [ediarum](https://www.ediarum.org/)-Modul [ediarum.DB](https://github.com/ediarum/ediarum.DB) verwaltet. Auf die Daten kann über die öffentlich verfügbare API zugegriffen werden. Mithilfe einer eXist-db-Applikation werden die einzelnen Endpoints der API definiert (s. oben).

### Frontend (Nuxt.js)

Die PTA Webapplikation nutzt das Vue.js-basierte Framework [Nuxt.js](https://nuxtjs.org/). Die Applikation wird per static site generator (SSG) statisch generiert und benötigt zum Einsatz einen Webserver. Daten aus dem Backend werden über die öffentlich verfügbare API geladen.

#### Module & Plugins
Folgende Zusatzmodule finden Einsatz in der PTA Webapp:

- [Vuex](https://vuex.vuejs.org): State Management
- [TailwindCSS](https://tailwindcss.com): CSS Framework
- [Nuxt Content](https://content.nuxtjs.org): Headless CMS
- [Nuxt i18n](https://i18n.nuxtjs.org): Übersetzung des Interface
- [Nuxt Axios](https://axios.nuxtjs.org/): AJAX Requests
- [Nuxt Optimized Images](https://github.com/juliomrqz/nuxt-optimized-images): Auto-optimierte Bilddateien
- [Matomo](https://matomo.org): User-Statistiken
- [CETEIcean.js](https://github.com/TEIC/CETEIcean): TEI-Rendering
- [V-RuntimeTemplate](https://github.com/alexjoverm/v-runtime-template): Runtime-Compilation von Vue Templates
- [V-Tooltip](https://akryum.github.io/v-tooltip/#/): Tooltip Library
- [Nuxt Leaflet](https://github.com/schlunsen/nuxt-leaflet): Karten

#### Rendering und Annotation von TEI XML
TEI XML Dateien werden in der PTA Webapp ohne Einsatz von XSLT-Transformationen über native Funktionen moderner Browser (Web Components bzw. Custom Elements) dargestellt. Hierfür nutzt PTA die Javascript Bibliothek [CETEIcean.js](https://github.com/TEIC/CETEIcean).

CETEIcean erlaubt nicht bloß das unmodifizierte Rendern von TEI direkt im Browser, es können in einem Zwischenschritt auch Modifikationen am letzlich gerenderten HTML vorgenommen werden. Hiervon wird z.B. in der Leseansicht Gebrauch gemacht, um den HTML-Code einer Vue Komponente zu injizieren, die dann Inhalte zu Textannotationen (Personen, Orte, Bibelstellen) via Popover-Fenstern anzeigt.

Das TEI-Rendering kann in folgenden Schritten zusammengefasst werden:

1. Abrufen der TEI-XML Daten zu gewünschtem Text via PTA API
2. Anzeige der erhaltenen TEI-Datei via CETEIcean.js, Injizierung von Annotations-Components an annotierten Textstellen
3. Pre-Rendern des resultierenden HTML-Strings via VRuntimeTemplate Plugin

#### Texte
Alle übrigen Texte auf PTA werden im Markdown-Format verfasst und via eines Headless CMS ([Nuxt Content](https://content.nuxtjs.org)) verwaltet bzw. eingebunden.

#### Interface-Sprachen
Das Interface ist aktuell in den Sprachen Deutsch und Englisch verfügbar, Italienisch ist in Vorbereitung. Technisch verwaltet werden Übersetzungen im i18n-Standard als JSON-Dateien. In Zukunft sind auch weitere Sprachen für das Interface geplant. Eine aktive [Mitwirkung](../project/contributing) ist sehr willkommen!

### Suche (eXist-DB)

Für die Suche stehen verschiedene Endpoints der API zur Verfügung (s.a. oben):

- `/api/search/fulltext` Suche im Volltext ohne Varianten und ohne Anmerkungen
- `/api/search/metadata` Suche in den Metadaten der Texte
- `/api/search/readings` Suche in den Varianten
- `/api/search/notes` Suche in den Anmerkungen

Die Suche basiert auf der in eXist-db integrierten Lucene-Suche. Die API-Endpoints werden über ediarum.WEB zur Verfügung gestellt. (S.a. die dortige [Dokumentation](https://github.com/ediarum/ediarum.WEB/blob/master/API.md#3-searching))

#### Suche mit regulären Ausdrücken

Suche nach allen Formen von "Sonne":

`/api/search/fulltext?type=regex&q=[ἡἥ]λ[ίι].{1,3}`

#### Suche nach Phrase mit Distanz

Eine Suche nach zwei Worten, die innerhalb einer bestimmten Distanz (`slop`) im Text auftauchen:

`/api/search/fulltext?type=phrase&slop=20&q=θεὸς ἄνθρωπον`

#### Suche mit Lucene-Ausdrücken

Mit der [Lucene-Syntax](https://lucene.apache.org/core/2_9_4/queryparsersyntax.html) können auch komplizierte Suchausdrücke formuliert werden. Möglich sind unter anderem Suchen mit:

- Wildcards (nicht in der Phrasensuche) `?`, `*`
  - etwa `te?t` oder `te*t`
- Fuzzy-Suche mit der Levenshtein-Distanz mit `~`
  - etwa `text~`
- Phrasensuche/Distanzsuche unter Angabe der Distanz (mit `~`)
  - etwa `"text lang"~10`
- Kombination von den genannte per `AND`, `NOT` und Gruppierung `(`, `)`
  - etwa `(edition OR translation) AND digital`
